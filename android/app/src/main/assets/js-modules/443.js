__d(function(e,t,n,r){"use strict";function o(e){return k(e)}function s(e,t){e=Array.prototype.slice.call(e);for(var n=0;n<t.length;++n)if(e.length>n&&typeof e[n]!==t[n])throw new TypeError("param "+n+" must be of type "+t[n])}function i(e,t){for(var n=Object.getOwnPropertyNames(t),r=Array.isArray(n),o=0,n=r?n:n["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var s;if(r){if(o>=n.length)break;s=n[o++]}else{if(o=n.next(),o.done)break;s=o.value}var i=s,a=typeof e[i],u=t[i],c="?"===u[u.length-1];if(c&&(u=u.slice(0,-1)),!c&&"undefined"===a)throw new Error(i+" is required, but a value was not provided.");if(a!==u)throw new TypeError(i+" must be of type '"+u+"' but was of type '"+a+"' instead.")}}function a(e,t){var n=new b(e),r="https:"===n.protocol?"realms":"realm",o=n.port?":"+n.port:"",s=r+"://"+n.hostname+o;return t||(t="/default"),new b(t,s,!1).toString()}function u(e,t){var n=new Request(e,t),r=new XMLHttpRequest;return r.timeout=t.timeout||0,new Promise(function(e,o){r.onload=function(){var t={status:r.status,statusText:r.statusText,url:r.responseURL,headers:r.responseHeaders};t.headers||(t.headers={"content-type":r.getResponseHeader("content-type")});var n="response"in r?r.response:r.responseText;e(new Response(n,t))},r.onerror=function(){return o(new TypeError("Network request failed"))},r.ontimeout=function(){return o(new TypeError("Network request failed"))},r.open(n.method,n.url,!0),n.headers.forEach(function(e,t){return r.setRequestHeader(t,e)}),r.send("undefined"==typeof n._bodyInit?t.body:n._bodyInit)})}function c(e,t){return e+("/"!=e.charAt(e.length-1)?"/":"")+t}function d(e,t,n,r){var o=_[e.identity];if(o||(_[e.identity]=o={}),!o[t]){var s=Math.max(r-Date.now()-j,P);o[t]=setTimeout(function(){delete o[t],p(e,t,n)},s)}}function h(){(console.error||console.log).apply(console,arguments)}function f(e,t,n,r){var o=e._sessionForOnDiskPath(t);if(o){var s=o.config.error;if(200!=n.status){var i=new g(r);return void(s?s(o,i):h("Unhandled session token refresh error for user "+e.identity+" at path "+t,i))}if("invalid"!==o.state)return o}}function l(e,t,n){var r=e.token,o=e.server,s=A(n),i=c(e.server,"realms/files/"+encodeURIComponent(s.pathname));O(i,{method:"GET",timeout:1e4,headers:{Authorization:e.token}}).then(function(e){return 404===e.status||503===e.status?{response:{status:200},json:{path:s.pathname,syncLabel:"_direct"}}:e.json().then(function(t){return{response:e,json:t}})}).then(function(n){var i=n.response,a=n.json,u=E.adminToken(r),c=e.constructor.login(o,u),d=f(c,t,i,a);d&&(s.set("pathname",a.path),d._refreshAccessToken(e.token,s.href,a.syncLabel))}).catch(function(r){h(r),setTimeout(function(){return p(e,t,n)},T)})}function p(e,t,n){if(e._sessionForOnDiskPath(t)){if(!e.server)throw new Error("Server for user must be specified");var r=A(n),o=r.pathname;if(!o)throw new Error("Unexpected Realm path inferred from url '"+n+"'. The path section of the url should be a non-empty string.");if(e.isAdminToken)return l(e,t,n);var s=c(e.server,"auth"),i={method:"POST",body:{data:e.token,path:o,provider:"realm",app_id:""},timeout:1e4},a=e.server,u=e.identity;O(s,i).then(function(e){return e.json().then(function(t){return{response:e,json:t}})}).then(function(o){var s=o.response,i=o.json,c=e.constructor._getExistingUser(a,u);if(c){var h=f(c,t,s,i);if(h){var l=i.access_token.token_data;r.set("pathname",l.path),h._refreshAccessToken(i.access_token.token,r.href,l.sync_label);var p=h.config.error;p&&p._notifyOnAccessTokenRefreshed&&p(h,p._notifyOnAccessTokenRefreshed);var m=new Date(1e3*l.expires);d(c,t,n,m)}}}).catch(function(r){h(r),setTimeout(function(){return p(e,t,n)},T)})}}function m(e,t,n,r){n.app_id="";var o=c(t,"auth"),s={method:"POST",body:n,open_timeout:5e3,timeout:5e3};return O(o,s).then(function(n){var r=n.headers.get("Content-Type");return r.indexOf("application/json")===-1?n.text().then(function(e){throw new g({title:"Could not authenticate: Realm Object Server didn't respond with valid JSON",body:e})}):n.ok?n.json().then(function(n){var r=n.refresh_token.token,o=n.refresh_token.token_data.identity,s=n.refresh_token.token_data.is_admin;return e.createUser(t,o,r,!1,s)}):n.json().then(function(e){return Promise.reject(new g(e))})},function(o){if(r<3)return m(e,t,n,r+1);throw o})}function v(e,t,n){var r=c(t,"auth/password/updateAccount"),o={method:"POST",body:n,open_timeout:5e3};return O(r,o).then(function(e){var t=e.headers.get("Content-Type");return t.indexOf("application/json")===-1?e.text().then(function(e){throw new g({title:"Could not update user account: Realm Object Server didn't respond with valid JSON",body:e})}):e.ok?void 0:e.json().then(function(e){return Promise.reject(new g(e))})})}var g=t(444).AuthError,y=t(445),w=t(450),k=t,b=t(446),_={},T=5e3,j=2e4,P=1e4,O=function(){var e="undefined"==typeof fetch?o("node-fetch"):u,t=[],n=0,r=5,s=function o(){if(!(n>=r)){var s=t.shift();if(s){var i=babelHelpers.slicedToArray(s,4),a=i[0],u=i[1],c=i[2],d=i[3];void 0===u.headers&&(u.headers={}),"undefined"!=typeof u.body&&("object"==typeof u.body&&(u.body=JSON.stringify(u.body)),"undefined"==typeof u.headers["content-type"]&&(u.headers["content-type"]="application/json;charset=utf-8")),u.headers.accept||(u.headers.accept="application/json"),++n,e(a,u).then(function(e){--n,o(),c(e)}).catch(function(e){--n,o(),d(e)})}}};return function(e,n){return new Promise(function(r,o){t.push([e,n,r,o]),s()})}}(),A=t(446),E={usernamePassword:function(e,t,n){return s(arguments,["string","string","boolean"]),new R("password",e,{register:n,password:t})},facebook:function(e){return s(arguments,["string"]),new R("facebook",e)},google:function(e){return s(arguments,["string"]),new R("google",e)},anonymous:function(){return new R("anonymous")},nickname:function(e,t){return s(arguments,["string","boolean"]),new R("nickname",e,{is_admin:t||!1})},azureAD:function(e){return s(arguments,["string"]),new R("azuread",e)},jwt:function(e,t){return s(arguments,["string","string"]),new R(t||"jwt",e)},adminToken:function(e){return s(arguments,["string"]),new R("adminToken",e)},custom:function(e,t,n){return n?s(arguments,["string","string","object"]):s(arguments,["string","string"]),new R(e,t,n)}},U={get current(){var e=this.all,t=Object.keys(e);if(0!==t.length){if(t.length>1)throw new Error("Multiple users are logged in");return e[t[0]]}},login:function(e,t){if(3===arguments.length){s(arguments,["string","string","string"]),console.warn("User.login is deprecated. Please use User.login(server, Credentials.usernamePassword(...)) instead.");var n=E.usernamePassword(arguments[1],arguments[2],!1);return this.login(e,n)}if(s(arguments,["string","object"]),"adminToken"===t.identityProvider){var r=this._adminUser(e,t.token);return r}return m(this,e,t,0)},deserialize:function(e){return e.adminToken?(i(e,{server:"string",adminToken:"string"}),this._adminUser(e.server,e.adminToken)):(i(e,{server:"string",identity:"string",refreshToken:"string",isAdmin:"boolean"}),this.createUser(e.server,e.identity,e.refreshToken,!1,e.isAdmin||!1))},requestPasswordReset:function(e,t){s(arguments,["string","string"]);var n={provider_id:t,data:{action:"reset_password"}};return v(this,e,n)},completePasswordReset:function(e,t,n){s(arguments,["string","string"]);var r={data:{action:"complete_reset",token:t,new_password:n}};return v(this,e,r)},requestEmailConfirmation:function(e,t){s(arguments,["string","string"]);var n={provider_id:t,data:{action:"request_email_confirmation"}};return v(this,e,n)},confirmEmail:function(e,t){s(arguments,["string","string"]);var n={data:{action:"confirm_email",token:t}};return v(this,e,n)},_refreshAccessToken:p,adminUser:function(e,t){s(arguments,["string","string"]),console.warn("User.adminUser is deprecated. Please use User.login(server, Credentials.adminToken(token)) instead.");var n=E.adminToken(e);return this.login(t,n)},register:function(e,t,n){s(arguments,["string","string","string"]),console.warn("User.register is deprecated. Please use User.login(server, Credentials.usernamePassword(...)) instead.");var r=E.usernamePassword(t,n,!0);return this.login(e,r)},registerWithProvider:function(e,t){s(arguments,["string","object"]),console.warn("User.registerWithProvider is deprecated. Please use User.login(server, Credentials.SOME-PROVIDER(...)) instead.");var n=E.custom(t.provider,t.providerToken,t.userInfo);return this.login(e,n)},authenticate:function(e,t,n){s(arguments,["string","string","object"]),console.warn("User.authenticate is deprecated. Please use User.login(server, Credentials.SOME-PROVIDER(...)) instead.");var r=void 0;switch(t.toLowerCase()){case"jwt":r=E.jwt(n.token,"jwt");break;case"password":r=E.usernamePassword(n.username,n.password);break;default:r=E.custom(t,n.data,n.user_info||n.userInfo)}return this.login(e,r)}},S={logout:function(){this._logout();var e=_[this.identity];e&&(Object.keys(e).forEach(function(t){clearTimeout(e[t])}),delete _[this.identity]);var t=A(this.server);t.set("pathname","/auth/revoke");var n={method:"POST",headers:{Authorization:this.token},body:{token:this.token},open_timeout:5e3};return O(t.href,n).catch(function(e){return h("An error occurred while logging out a user",e)})},serialize:function(){return this.isAdminToken?{server:this.server,adminToken:this.token}:{server:this.server,refreshToken:this.token,identity:this.identity,isAdmin:this.isAdmin}},openManagementRealm:function(){var e=A(this.server);if("http:"===e.protocol)e.set("protocol","realm:");else{if("https:"!==e.protocol)throw new Error("Unexpected user auth url: "+this.server);e.set("protocol","realms:")}return e.set("pathname","/~/__management"),new this.constructor._realmConstructor({schema:t(449),sync:{user:this,url:e.href}})},retrieveAccount:function(e,t){s(arguments,["string","string"]);var n=A(this.server);n.set("pathname","/auth/users/"+e+"/"+t);var r={method:"GET",headers:{Authorization:this.token},open_timeout:5e3};return O(n.href,r).then(function(e){return 200!==e.status?e.json().then(function(e){throw new g(e)}):e.json()})},createConfiguration:function(e){if(e&&e.sync&&(e.sync.user&&void 0!==console.warn&&console.warn("'user' property will be overridden by "+this.identity),void 0!==e.sync.partial&&void 0!==e.sync.fullSynchronization))throw new Error("'partial' and 'fullSynchronization' were both set. 'partial' has been deprecated, use only 'fullSynchronization'");var t={sync:{user:this}};e&&e.sync&&e.sync.partial||(t.sync.fullSynchronization=!1);var n=void 0===e?t:w(t,e);return n.sync.user=this,n.sync.url=a(this.server,e&&e.sync?e.sync.url:void 0),n}},R=function(){function e(t,n,r){babelHelpers.classCallCheck(this,e),this.identityProvider=t,this.token=n,this.userInfo=r||{}}return babelHelpers.createClass(e,[{key:"toJSON",value:function(){return{data:this.token,provider:this.identityProvider,user_info:this.userInfo}}}]),e}();babelHelpers.extends(S,y),n.exports={static:U,instance:S,credentials:E}},443);